<!DOCTYPE html>
{% load static %}
{% load my_filter %}
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Trollymate | My Profile</title>

    <!-- Admin Assets -->
    <link href="{% static 'assets/img/favicon.png' %}" rel="icon">
    <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">
    
    <style>
        :root {
            --admin-bg: radial-gradient(circle at top, #e5f0ff 0%, #c7d2fe 50%, #818cf8 100%);
            --admin-header: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            --admin-card: rgba(255,255,255,0.95);
            --admin-shadow: 0 25px 60px rgba(0,0,0,0.15);
            --admin-glow: 0 0 30px rgba(79,70,229,0.3);
            --primary-gradient: linear-gradient(135deg, #4f46e5, #7c3aed);
        }
        body {
            background: var(--admin-bg);
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }
        .admin-header {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 24px;
            box-shadow: var(--admin-shadow);
        }
        .admin-card {
            backdrop-filter: blur(25px);
            background: var(--admin-card);
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 28px;
            box-shadow: var(--admin-shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        .admin-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 35px 80px rgba(0,0,0,0.2);
        }
        .profile-avatar {
            width: 160px;
            height: 160px;
            object-fit: cover;
            border-radius: 50%;
            border: 6px solid rgba(255,255,255,0.95);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            transition: all 0.4s ease;
        }
        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 30px 70px var(--admin-glow);
        }
        .stats-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
            box-shadow: 0 10px 30px rgba(16,185,129,0.4);
            z-index: 10;
        }
        .nav-tabs {
            border: none;
            background: rgba(255,255,255,0.9);
            border-radius: 24px;
            padding: 4px;
            backdrop-filter: blur(20px);
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .nav-tabs .nav-link {
            border-radius: 20px;
            padding: 14px 24px;
            font-weight: 700;
            font-size: 0.95rem;
            border: none;
            background: transparent;
            color: #64748b;
            transition: all 0.3s ease;
            letter-spacing: 0.3px;
        }
        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--admin-glow);
            transform: translateY(-2px);
        }
        .nav-tabs .nav-link:hover {
            color: #4f46e5;
            background: rgba(79,70,229,0.1);
            transform: translateY(-1px);
        }
        .info-card {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.5);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .info-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }
        .order-status {
            font-size: 0.8rem;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 700;
        }
        .form-control {
            border-radius: 16px;
            border: 2px solid rgba(79,70,229,0.2);
            padding: 16px 20px;
            background: rgba(255,255,255,0.9);
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        .form-control:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79,70,229,0.15);
            background: white;
            transform: translateY(-1px);
        }
        .form-control.form-control-lg {
            padding: 16px 20px;
            font-size: 1rem;
        }
        .btn-modern {
            border-radius: 50px;
            padding: 14px 36px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: var(--primary-gradient);
            box-shadow: 0 12px 30px rgba(79,70,229,0.4);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(79,70,229,0.5);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 12px 30px rgba(239,68,68,0.4);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(239,68,68,0.5);
            color: white;
        }
        .btn-outline-secondary {
            border-left: none;
            border-radius: 0 16px 16px 0;
        }
        .btn-outline-secondary:hover {
            background-color: rgba(79,70,229,0.1);
        }
        .table-dark {
            background: var(--primary-gradient);
        }
        .status-delivered { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .status-cancelled { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .status-pending { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        
        /* Password Form Enhancements */
        #passwordMatch {
            font-weight: 500;
        }
        #passwordMatch.valid {
            color: #10b981 !important;
        }
        #passwordMatch.invalid {
            color: #ef4444 !important;
        }
        
        @media (max-width: 768px) {
            .profile-avatar { width: 120px; height: 120px; }
            .nav-tabs .nav-link { padding: 12px 16px; font-size: 0.9rem; }
            .btn-outline-secondary { border-radius: 0 12px 12px 0; }
        }
    </style>
</head>

<body class="pt-5">
    <!-- Fixed Glass Header -->
    <header class="admin-header fixed-top shadow-lg px-4 py-3 z-3">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <a href="{% url 'users:index' %}" class="d-flex align-items-center text-decoration-none">
                    <i class="bi bi-cart4 fs-2" style="background: var(--primary-gradient); color: white; padding: 12px; border-radius: 16px; box-shadow: var(--admin-glow);"></i>
                    <span class="fw-bold fs-3 ms-3" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Trollymate</span>
                </a>
                <div class="d-flex align-items-center bg-white bg-opacity-95 p-2 rounded-pill shadow-lg">
                    <img src="{{ rec.image.url }}" alt="Profile" class="rounded-circle me-2" style="width: 48px; height: 48px; object-fit: cover; border: 4px solid rgba(79,70,229,0.3);">
                    <span class="fw-semibold text-dark">{{ rec.fname }}</span>
                </div>
            </div>
        </div>
    </header>

    <main class="main pt-5">
        <div class="container tm-shell mt-5">
            <!-- Page Header -->
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold mb-3" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    My Profile
                </h1>
                <p class="lead text-white opacity-90 mb-0" style="text-shadow: 0 2px 10px rgba(0,0,0,0.3);">Manage account settings and track your orders</p>
            </div>

            <section class="section">
                <div class="row g-4">
                    <!-- Profile Card -->
                    <div class="col-xl-4">
                        <div class="admin-card position-relative h-100 p-5 text-center">
                            <div class="stats-badge">
                                <i class="bi bi-person-check-fill"></i>
                            </div>
                            <div class="position-relative mb-4">
                                <img src="{{ rec.image.url }}" alt="Profile" class="profile-avatar mx-auto d-block">
                               
                            </div>
                            <h3 class="fw-bold mb-2" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">{{ rec.fname }} {{ rec.lname }}</h3>
                            <p class="text-dark fw-semibold mb-2 fs-5">{{ recemail }}</p>
                            <div class="bg-white bg-opacity-30 backdrop-blur rounded-pill px-4 py-2 mb-4 shadow-sm">
                                <i class="bi bi-telephone-fill text-primary me-2"></i>
                                <span class="fw-semibold">{{ rec.phone }}</span>
                            </div>

                            <!-- Order Stats -->
                            <div class="row g-3 text-center">
                                <div class="col-4">
                                    <div class="h4 fw-bold text-primary mb-1">{{ total_orders }}</div>
                                    <small class="text-muted">Total Orders</small>
                                </div>
                                <div class="col-4">
                                    <div class="h4 fw-bold text-success mb-1">{{ delivered_orders }}</div>
                                    <small class="text-success">Delivered</small>
                                </div>
                                <div class="col-4">
                                    <div class="h4 fw-bold text-warning mb-1">{{ pending_orders }}</div>
                                    <small class="text-warning">Pending</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Tabs -->
                    <div class="col-xl-8">
                        <div class="admin-card p-5">
                            <!-- Tabs Navigation -->
                            <ul class="nav nav-tabs justify-content-center mb-0" id="profileTabs" role="tablist">
                                <li class="nav-item">
                                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-overview">
                                        <i class="bi bi-info-circle-fill me-2"></i>Overview
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-edit">
                                        <i class="bi bi-pencil-square me-2"></i>Edit Profile
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-orders">
                                        <i class="bi bi-box-seam me-2"></i>Orders ({{ total_orders }})
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-password">
                                        <i class="bi bi-lock-fill me-2"></i>Password
                                    </button>
                                </li>
                            </ul>

                            <!-- Tab Content -->
                            <div class="tab-content pt-4">
                                <!-- Overview Tab -->
                                <div class="tab-pane fade show active" id="profile-overview">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="info-card position-relative">
                                                
                                                <h6 class="fw-bold mb-2 mt-4">Full Name</h6>
                                                <p class="fs-5 fw-semibold text-primary mb-0">{{ rec.fname }} {{ rec.lname }}</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="info-card position-relative">
                                                
                                                <h6 class="fw-bold mb-2 mt-4">Email Address</h6>
                                                <p class="text-dark fs-6 mb-0">{{ recemail }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Profile Tab -->
                                <div class="tab-pane fade" id="profile-edit">
                                    <form method="POST" enctype="multipart/form-data" action="{% url 'users:cust_update' %}" class="needs-validation" novalidate>
                                        {% csrf_token %}
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold fs-6 mb-2">First Name</label>
                                                <input name="fname" type="text" class="form-control form-control-lg" value="{{ rec.fname }}" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold fs-6 mb-2">Last Name</label>
                                                <input name="lname" type="text" class="form-control form-control-lg" value="{{ rec.lname }}" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold fs-6 mb-2">Email</label>
                                                <input name="email" type="email" class="form-control form-control-lg" value="{{ rec.email }}" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold fs-6 mb-2">Phone</label>
                                                <input name="phone" type="tel" class="form-control form-control-lg" value="{{ rec.phone }}" required>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label fw-bold fs-6 mb-2">Profile Photo</label>
                                                <div class="d-flex align-items-center">
                                                    <img src="{{ rec.image.url }}" alt="Current" 
                                                         style="width: 80px; height: 80px; object-fit: cover; border-radius: 16px; margin-right: 1rem; border: 3px solid rgba(79,70,229,0.2);">
                                                    <input type="file" name="image" class="form-control form-control-lg" accept="image/*">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-5">
                                            <button type="submit" class="btn btn-modern btn-primary px-6 me-3 shadow-lg">
                                                <i class="bi bi-check-circle-fill me-2"></i>Save Changes
                                            </button>
                                            <a href="{% url 'users:cust_soft' %}" class="btn btn-modern btn-danger px-6 shadow-lg">
                                                <i class="bi bi-trash3-fill me-2"></i>Delete Account
                                            </a>
                                        </div>
                                    </form>
                                </div>

                                <!-- Orders Tab -->
                                <div class="tab-pane fade" id="profile-orders">
                                    {% if orders %}
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h5 class="fw-bold mb-0 fs-3">
                                            <i class="bi bi-boxes me-2 text-primary"></i>Order History
                                            <span class="badge bg-primary fs-6 ms-2">{{ orders|length }}</span>
                                        </h5>
                                    </div>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-hover align-middle">
                                            <thead class="table-dark rounded-3 overflow-hidden">
                                                <tr>
                                                    <th>Product</th>
                                                    <th>Date</th>
                                                    <th>Qty</th>
                                                    <th>Price</th>
                                                    <th>Total</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for order in orders %}
                                                <tr class="align-middle">
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            {% if order.p_image %}
                                                            <img src="{{ order.p_image.url }}" alt="{{ order.p_name }}" 
                                                                 class="rounded-3 me-3 shadow-sm" style="width: 56px; height: 56px; object-fit: cover;">
                                                            {% else %}
                                                            <div class="bg-light rounded-3 d-flex align-items-center justify-content-center me-3 shadow-sm text-muted" 
                                                                 style="width: 56px; height: 56px;">
                                                                <i class="bi bi-box fs-5"></i>
                                                            </div>
                                                            {% endif %}
                                                            <div>
                                                                <div class="fw-bold">{{ order.p_name|truncatechars:25 }}</div>
                                                                <small class="text-muted">#{{ order.p_id }}</small>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="fw-semibold">{{ order.shop_date|date:"d MMM"|default:order.p_date|slice:":10" }}</div>
                                                        <small class="text-muted">{{ order.shop_date|time:"H:i"|default:"â€”" }}</small>
                                                    </td>
                                                    <td>
                                                        <span class="badge bg-light text-dark px-3 py-2 fs-6">{{ order.p_quantity|default:"â€”" }}</span>
                                                    </td>
                                                    <td><strong class="fs-6 text-primary">â‚¹{{ order.p_price }}</strong></td>
                                                    <td>
                                                        <strong class="fs-5 text-primary">
                                                            â‚¹{{ order.p_quantity|mul:order.p_price|default:order.p_price }}
                                                        </strong>
                                                    </td>
                                                    <td>
                                                        <span class="order-status px-3 py-2 fw-bold rounded-pill status-{{ order.status|yesno:'delivered,cancelled,pending' }}">
                                                            {% if order.status %}Delivered
                                                            {% elif order.status == False %}Cancelled
                                                            {% else %}Pending{% endif %}
                                                        </span>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% else %}
                                    <div class="text-center py-8">
                                        <div class="bg-white bg-opacity-30 rounded-circle mx-auto mb-4 p-5 d-inline-block shadow-lg" style="width: 140px; height: 140px;">
                                            <i class="bi bi-bag-heart-fill fs-1 text-primary"></i>
                                        </div>
                                        <h4 class="text-primary mb-3 fw-bold">No Orders Yet</h4>
                                        <p class="text-white-50 lead mb-5">Start your shopping journey with Trollymate!</p>
                                        <a href="{% url 'users:index' %}" class="btn btn-modern btn-primary px-6 shadow-lg">
                                            <i class="bi bi-shop me-2"></i>Start Shopping
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>

                                                                                <!-- ðŸ”¥ PASSWORD TAB - FULLY FUNCTIONAL ðŸ”¥ -->
                                                                            <!-- ðŸ”¥ PERFECT PASSWORD FORM - NO BUGS! -->
                                                <div class="tab-pane fade" id="profile-password">
                                                    {% if messages %}
                                                        <div class="row mb-4">
                                                            {% for message in messages %}
                                                                <div class="col-12">
                                                                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                                                        {{ message }}
                                                                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                                                    </div>
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}

                                                    <form method="POST" action="{% url 'users:cust_update' %}" class="needs-validation" novalidate id="passwordForm">
                                                        {% csrf_token %}
                                                        <!-- âœ… NO HIDDEN FIELD - FIELD NAMES ONLY -->
                                                        
                                                        <div class="row g-4">
                                                            <!-- Current Password -->
                                                            <div class="col-md-6">
                                                                <label for="current_password" class="form-label fw-bold fs-6 mb-2">
                                                                    Current Password <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="input-group">
                                                                    <input type="password" 
                                                                        class="form-control form-control-lg" 
                                                                        id="current_password"
                                                                        name="current_password"
                                                                        placeholder="Enter current password"
                                                                        required autocomplete="current-password">
                                                                    <button class="btn btn-outline-secondary" type="button" id="toggleCurrent">
                                                                        <i class="bi bi-eye" id="currentIcon"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="invalid-feedback">Current password is required</div>
                                                            </div>

                                                            <!-- New Password -->
                                                            <div class="col-md-6">
                                                                <label for="new_password" class="form-label fw-bold fs-6 mb-2">
                                                                    New Password <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="input-group">
                                                                    <input type="password" 
                                                                        class="form-control form-control-lg" 
                                                                        id="new_password"
                                                                        name="new_password"
                                                                        placeholder="Enter new password"
                                                                        required minlength="6" autocomplete="new-password">
                                                                    <button class="btn btn-outline-secondary" type="button" id="toggleNew">
                                                                        <i class="bi bi-eye" id="newIcon"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="invalid-feedback">Password must be at least 6 characters</div>
                                                            </div>

                                                            <!-- Confirm Password -->
                                                            <div class="col-12">
                                                                <label for="confirm_password" class="form-label fw-bold fs-6 mb-2">
                                                                    Confirm New Password <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="input-group">
                                                                    <input type="password" 
                                                                        class="form-control form-control-lg" 
                                                                        id="confirm_password"
                                                                        name="confirm_password"
                                                                        placeholder="Confirm new password"
                                                                        required minlength="6" autocomplete="new-password">
                                                                    <button class="btn btn-outline-secondary" type="button" id="toggleConfirm">
                                                                        <i class="bi bi-eye" id="confirmIcon"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="invalid-feedback">Passwords do not match</div>
                                                                <div id="passwordMatch" class="form-text"></div>
                                                            </div>
                                                        </div>

                                                        <!-- âœ… FIXED BUTTON - DIRECT SUBMIT -->
                                                        <div class="text-center mt-5">
                                                            <button type="submit" class="btn btn-modern btn-primary px-6 me-3 shadow-lg">
                                                                <i class="bi bi-shield-lock-fill me-2"></i>Update Password
                                                            </button>
                                                            <button type="reset" class="btn btn-modern btn-outline-secondary px-6">
                                                                <i class="bi bi-arrow-clockwise me-2"></i>Reset Form
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script>
        // ðŸ”¥ ENHANCED JAVASCRIPT WITH PASSWORD FEATURES ðŸ”¥
        document.addEventListener('DOMContentLoaded', function() {
            initFormValidation();
            initPasswordToggle();
            initPasswordValidation();
        });

        // 1. Basic Form Validation
        function initFormValidation() {
            document.querySelectorAll('.needs-validation').forEach(form => {
                form.addEventListener('submit', e => {
                    if (!form.checkValidity()) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }

        // 2. Password Visibility Toggle
        function initPasswordToggle() {
            document.getElementById('toggleCurrent')?.addEventListener('click', function() {
                togglePassword('current_password', 'currentIcon');
            });
            document.getElementById('toggleNew')?.addEventListener('click', function() {
                togglePassword('new_password', 'newIcon');
            });
            document.getElementById('toggleConfirm')?.addEventListener('click', function() {
                togglePassword('confirm_password', 'confirmIcon');
            });
        }

        function togglePassword(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        }

        // 3. Real-time Password Validation
        function initPasswordValidation() {
            const newPass = document.getElementById('new_password');
            const confirmPass = document.getElementById('confirm_password');
            const matchDiv = document.getElementById('passwordMatch');

            if (newPass && confirmPass && matchDiv) {
                newPass.addEventListener('input', validatePasswordMatch);
                confirmPass.addEventListener('input', validatePasswordMatch);
            }
        }

        function validatePasswordMatch() {
            const newPass = document.getElementById('new_password').value;
            const confirmPass = document.getElementById('confirm_password').value;
            const matchDiv = document.getElementById('passwordMatch');

            if (newPass && confirmPass) {
                if (newPass === confirmPass && newPass.length >= 6) {
                    matchDiv.textContent = 'âœ“ Passwords match';
                    matchDiv.className = 'form-text valid';
                } else {
                    matchDiv.textContent = newPass === confirmPass ? '' : 'âœ— Passwords do not match';
                    matchDiv.className = 'form-text invalid';
                }
            } else {
                matchDiv.textContent = '';
            }
        }

        // 4. Reset Password Form
        function resetPasswordForm() {
            document.getElementById('passwordForm').reset();
            document.getElementById('passwordMatch').textContent = '';
            
            // Reset password visibility
            ['current_password', 'new_password', 'confirm_password'].forEach(id => {
                const input = document.getElementById(id);
                if (input) input.type = 'password';
            });
            
            ['currentIcon', 'newIcon', 'confirmIcon'].forEach(id => {
                const icon = document.getElementById(id);
                if (icon) {
                    icon.classList.remove('bi-eye-slash');
                    icon.classList.add('bi-eye');
                }
            });
        }

        // 5. Auto-dismiss alerts
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                const bsAlert = new bootstrap.Alert(alert);
                setTimeout(() => bsAlert.close(), 5000);
            });
        }, 100);
    </script>
</body>
</html>
